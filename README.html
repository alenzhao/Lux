<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lux</title>
<link rel="stylesheet" href="https://stackedit.io/res-min/themes/base.css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body><div class="container"><h1 id="lux">Lux</h1>



<h2 id="overview">Overview</h2>

<p>Lux is an integrative hierarchical Bayesian model for analyzing BS-seq and oxBS-seq data enabling accurate and unbiased quantification of different cytosine modifications and differential methylation at individual cytosines or loci, with or without replicates, while taking imperfect experimental parameters into account.</p>



<h2 id="navigation">Navigation</h2>

<p><div class="toc">
<ul>
<li><a href="#lux">Lux</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#navigation">Navigation</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#downloads">Downloads</a><ul>
<li><ul>
<li><a href="#example-data">Example data</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#quick-introduction">Quick introduction</a></li>
<li><a href="#installation">Installation</a><ul>
<li><ul>
<li><a href="#installing-cmdstan">Installing CmdStan</a></li>
<li><a href="#compiling-lux">Compiling Lux</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#using-lux">Using Lux</a><ul>
<li><a href="#generating-input-files">Generating input files</a><ul>
<li><a href="#noncontrol-cytosines">Noncontrol cytosines</a></li>
<li><a href="#control-cytosines">Control cytosines</a></li>
</ul>
</li>
<li><a href="#summarizing-hmc-chains">Summarizing HMC chains</a><ul>
<li><a href="#interpreting-the-parameters-in-the-implementation">Interpreting the parameters in the implementation</a></li>
</ul>
</li>
<li><a href="#detecting-differential-methylation">Detecting differential methylation</a></li>
<li><a href="#advanced-uses">Advanced uses</a></li>
<li><a href="#references">References</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</p>



<h2 id="features">Features</h2>

<ul>
<li>Model-based integration and analysis of BS-seq and oxBS-seq data from whole genome, reduced representation or targeted experiments</li>
<li>Consideration of nonideal experimental parameters through modeling</li>
<li>Model-based integration of biological replicates</li>
<li>Detection of differential methylation at individual cytosines or regions using Bayes factors (DMRs)</li>
<li>Full Bayesian inference with Hamiltonian Monte Carlo (HMC) using No-U-Turn sampler (NUTS) implemented in <strong>Stan</strong></li>
</ul>



<h2 id="downloads">Downloads</h2>



<h4 id="example-data">Example data</h4>

<p>Here we provide the input data sets and the obtained HMC chains used in the publication.</p>

<p>Input data <br>
<a href="https://dl.dropboxusercontent.com/u/2392459/v65_t2kd_data.tar.bz2">v65_t2kd_data.tar.bz2</a></p>

<p>Output chains <br>
<a href="https://dl.dropboxusercontent.com/u/2392459/v65_t2kd_chains.tar.bz2">v65_t2kd_chains.tar.bz2</a></p>



<h2 id="quick-introduction">Quick introduction</h2>

<p>An usual Lux pipeline has the following steps <br>
1. Alignment of BS-seq and oxBS-seq data (e.g., <a href="http://www.bioinformatics.babraham.ac.uk/projects/bismark/">Bismark</a> or <a href="http://rafalab.jhsph.edu/bsmooth/">BSmooth</a> <br>
2.  Extraction of converted and unconverted counts (e.g., <a href="http://www.bioinformatics.babraham.ac.uk/projects/bismark/">Bismark</a> or <a href="http://rafalab.jhsph.edu/bsmooth/">BSmooth</a>) <br>
3. Generation of input files for <strong>Lux</strong> (<strong>parse.py</strong>) <br>
4. Integrative methylation analysis (<strong>Lux</strong>) <br>
5. Calculation of Bayes factors (<strong>bf.py</strong>)</p>

<blockquote>
  <p><strong>Note:</strong> <br>
  This documentation focus on the the points three, four, and five.</p>
</blockquote>



<h2 id="installation">Installation</h2>

<p>Below the environmental parameters <strong><span>$</span>STAN_HOME</strong> and <strong><span>$</span>LUX_HOME</strong> refers to the source directories of <strong>CmdStan</strong> and <strong>Lux</strong>.</p>

<ul>
<li><strong>Lux</strong> requires <strong>CmdStan</strong> (tested on version 2.2.0)</li>
<li><strong>parse.py</strong> and <strong>bf.py</strong> requires <strong>Python</strong> (tested on version 2.7.5), <strong>NumPy</strong> (tested on version 1.7.1) and <strong>Scipy</strong> (tested on version 0.13.0)</li>
</ul>



<h4 id="installing-cmdstan">Installing CmdStan</h4>

<p>To install <strong>CmdStan</strong>, please first download the source code of <strong>CmdStan</strong> from <a href="http://mc-stan.org/interfaces/cmdstan.html">http://mc-stan.org/interfaces/cmdstan.html</a> and follow the included installation instructions.</p>

<p>To cut the long story short, after extracting the source code running the following commands should be sufficient for our purposes</p>

<pre><code>cd $STAN_HOME
make bin/print
make bin/stanc
</code></pre>

<p>The binaries stanc and print are used for translating <strong>Stan</strong> codes into executables and summarizing HMC chains, respectively.</p>

<p>For more details on installing <strong>CmdStan</strong>, please see <strong><span>$</span>STAN_HOME/README.txt</strong> and the documentation of <strong>CmdStan</strong> available at [<a href="http://mc-stan.org/manual.html]">http://mc-stan.org/manual.html]</a>.</p>



<h4 id="compiling-lux">Compiling Lux</h4>

<p>The Lux source code is supplied in the file <strong><span>$</span>LUX_HOME/lux.stan</strong>. <br>
The use of Lux requires that it is first compiled for the platform in use, which can be done using the installed <strong>CmdStan</strong></p>

<pre><code>cd $STAN_HOME
make $LUX_HOME/lux
</code></pre>

<p>After the compilation is done the directory <strong>$LUX_HOME</strong> should have a binary with the name lux.</p>

<p>For more details on the compilation, such as code optimization, please see the documentation of <strong>CmdStan</strong> available at <a href="http://mc-stan.org/documentation/">http://mc-stan.org/documentation/</a>.</p>

<h2 id="using-lux">Using Lux</h2>

<p>After completing the previous steps <strong>Lux</strong> is ready to be used. As an example, one can run <strong>Lux</strong> with the supplied cytosine-level data sets used in the manuscript as follows</p>

<pre><code>cd $LUX_HOME
./lux method=sample algorithm=hmc engine=nuts max_depth=8 stepsize=0.02 data file=data/v65_data.R init=data/v65_init.R output file=v65_output.csv
./lux method=sample algorithm=hmc engine=nuts max_depth=8 stepsize=0.02 data file=data/t2kd_data.R init=data/t2kd_init.R output file=t2kd_output.csv
</code></pre>

<p><strong>Stan</strong> uses the dump data format, and thus the data and init files have to be in that format. A procedure for generating these data files is described below.</p>

<p>For more details, please see the documentation of <strong>CmdStan</strong> available at <a href="http://mc-stan.org/documentation/">http://mc-stan.org/documentation/</a>.</p>



<h3 id="generating-input-files">Generating input files</h3>

<p>A python script <strong>parse.py</strong> is supplied for generating input files for the use with <strong>Lux</strong>. Basically it transforms the user-supplied data files into the data format read by <strong>CmdStan</strong>, in addition, it initializes the model parameters with values sampled from the corresponding priors</p>

<pre><code>usage: parse.py [-h] -d DATA -p PRIOR -cd CONTROL_DATA -cp CONTROL_PRIOR -pr PREFIX [-v]

Generates data and init files in the dump format for Lux

 optional arguments:
 -h, --help    show this help message and exit
 -d DATA, --data DATA    noncontrol cytosine data
 -p PRIOR, --prior PRIOR    prior of the noncontrol cytosines
  -cd CONTROL_DATA, --control-data CONTROL_DATA    control cytosine data
  -cp CONTROL_PRIOR, --control-prior CONTROL_PRIOR    priors of the control cytosines
  -pr PREFIX, --prefix PREFIX    prefix of the output files
 -v, --version    show program's version number and exit
</code></pre>

<p>For instance, the script <strong>parse.py</strong> is called as</p>

<pre><code>./parse.py --data data.tsv --prior prior.tsv --control-data control_data.tsv --control-prior control_prior.tsv --prefix sample
</code></pre>

<p>This command will generate the two files, <strong>sample_data.R</strong> and <strong>sample_init.R</strong>, which are ready to be used in <strong>Lux</strong>.</p>

<p>As you notice <strong>parse.py</strong> takes four files as input, so next, we will go through their content and format in detail.</p>

<h4 id="noncontrol-cytosines">Noncontrol cytosines</h4>

<p>The files <strong>data.tsv</strong> and <strong>prior.tsv</strong> have the count data and prior information on the noncontrol cytosines of interest, respectively.</p>

<p>Each of the cytosines has its own line in the files, and thus the files are required to have the same number of lines, moreover, the order of the cytosines is assumed to be the same in the files. </p>

<p>Each line in the file <strong>data.tsv</strong> is composed of one or more replicate-specific tab-separated blocks of four tab-separated nonnegative integers</p>

<blockquote>
  <p><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msubsup><mi>N</mi><mtext>BS</mtext><mtext>C</mtext></msubsup></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.176ex" height="3.253ex" viewBox="0 -949.6 1798 1400.4" role="img" focusable="false" style="vertical-align: -1.047ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-43" x="1292" y="509"></use><g transform="translate(803,-335)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-42"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-53" x="708" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msubsup><mi>N</mi><mtext>BS</mtext><mtext>C</mtext></msubsup></math></span></span><script type="math/tex" id="MathJax-Element-1">N_\text{BS}^\text{C}</script>\t<span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>N</mi><mtext>BS</mtext></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.176ex" height="2.326ex" viewBox="0 -750.1 1798 1001.4" role="img" focusable="false" style="vertical-align: -0.584ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-4E" x="0" y="0"></use><g transform="translate(803,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-42"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-53" x="708" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>N</mi><mtext>BS</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-2">N_\text{BS}</script>\t<span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msubsup><mi>N</mi><mtext>oxBS</mtext><mtext>C</mtext></msubsup></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.866ex" height="3.253ex" viewBox="0 -949.6 2525.6 1400.4" role="img" focusable="false" style="vertical-align: -1.047ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-43" x="1292" y="509"></use><g transform="translate(803,-335)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6F"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-78" x="500" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-42" x="1029" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-53" x="1737" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msubsup><mi>N</mi><mtext>oxBS</mtext><mtext>C</mtext></msubsup></math></span></span><script type="math/tex" id="MathJax-Element-3">N_\text{oxBS}^\text{C}</script>\t<span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>N</mi><mtext>oxBS</mtext></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.866ex" height="2.326ex" viewBox="0 -750.1 2525.6 1001.4" role="img" focusable="false" style="vertical-align: -0.584ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-4E" x="0" y="0"></use><g transform="translate(803,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6F"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-78" x="500" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-42" x="1029" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-53" x="1737" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>N</mi><mtext>oxBS</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-4">N_\text{oxBS}</script></p>
</blockquote>

<p>That is, the number of Cs and the total BS-seq read-outs are listed first, which are followed by the number of Cs and total oxBS-seq read-outs.</p>

<p>Moreover, on each line there should be exactly <span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>4</mn><mo>&amp;#x00D7;</mo><msub><mi>N</mi><mtext>replicates</mtext></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.874ex" height="2.524ex" viewBox="0 -740.1 5543.1 1086.5" role="img" focusable="false" style="vertical-align: -0.805ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-34" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-D7" x="722" y="0"></use><g transform="translate(1723,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-4E" x="0" y="0"></use><g transform="translate(803,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-72"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65" x="392" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-70" x="837" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6C" x="1393" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-69" x="1672" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-63" x="1950" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-61" x="2395" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-74" x="2895" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65" x="3285" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-73" x="3729" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mo>×</mo><msub><mi>N</mi><mtext>replicates</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-5">4 \times N_\text{replicates}</script> values separated with the tabs.</p>

<p>The replicate-level in the hierarchical model formulation explicitly assumes that the replicates share the same prior. Thus, the prior of <span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03BC;</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.402ex" height="1.952ex" viewBox="0 -543.3 603.5 840.5" role="img" focusable="false" style="vertical-align: -0.69ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3BC" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi></math></span></span><script type="math/tex" id="MathJax-Element-6">\mu</script> is defined by giving the parameter <span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B1;</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.488ex" height="1.495ex" viewBox="0 -543.3 640.5 643.7" role="img" focusable="false" style="vertical-align: -0.233ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">\alpha</script> for all the noncontrol cytosines in terms of three pseudo-counts <span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03B1;</mi><mn>1</mn></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.542ex" height="1.838ex" viewBox="0 -543.3 1094.4 791.3" role="img" focusable="false" style="vertical-align: -0.576ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-31" x="905" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-8">\alpha_1</script>, <span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03B1;</mi><mn>2</mn></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.542ex" height="1.838ex" viewBox="0 -543.3 1094.4 791.3" role="img" focusable="false" style="vertical-align: -0.576ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-32" x="905" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-9">\alpha_2</script> and <span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03B1;</mi><mn>3</mn></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.542ex" height="1.838ex" viewBox="0 -543.3 1094.4 791.3" role="img" focusable="false" style="vertical-align: -0.576ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-33" x="905" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mn>3</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-10">\alpha_3</script> corresponding to <span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>C</mtext><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.746ex" height="2.752ex" viewBox="-38.5 -838.5 2043.5 1184.9" role="img" focusable="false" style="vertical-align: -0.805ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-70" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-28" x="503" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-43" x="893" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-29" x="1615" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mtext>C</mtext><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-11">p(\text{C})</script>, <span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>5mC</mtext><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.845ex" height="2.752ex" viewBox="-38.5 -838.5 3377.5 1184.9" role="img" focusable="false" style="vertical-align: -0.805ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-70" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-28" x="503" y="0"></use><g transform="translate(893,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-35"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6D" x="500" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-43" x="1334" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-29" x="2949" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mtext>5mC</mtext><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-12">p(\text{5mC})</script> and <span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>5hmC</mtext><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.137ex" height="2.752ex" viewBox="-38.5 -838.5 3934 1184.9" role="img" focusable="false" style="vertical-align: -0.805ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-70" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-28" x="503" y="0"></use><g transform="translate(893,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-35"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-68" x="500" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6D" x="1057" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-43" x="1890" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-29" x="3506" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mtext>5hmC</mtext><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-13">p(\text{5hmC})</script>, respectively.</p>

<p>That is, all the lines in the file <strong>prior.tsv</strong> are required to have the following format</p>

<blockquote>
  <p><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03B1;</mi><mn>1</mn></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.542ex" height="1.747ex" viewBox="0 -500.7 1094.4 752.1" role="img" focusable="false" style="vertical-align: -0.584ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-31" x="905" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-14">\alpha_1</script>\t<span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03B1;</mi><mn>2</mn></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.542ex" height="1.747ex" viewBox="0 -500.7 1094.4 752.1" role="img" focusable="false" style="vertical-align: -0.584ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-32" x="905" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-15">\alpha_2</script>\t<span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03B1;</mi><mn>3</mn></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.542ex" height="1.747ex" viewBox="0 -500.7 1094.4 752.1" role="img" focusable="false" style="vertical-align: -0.584ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-33" x="905" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mn>3</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-16">\alpha_3</script></p>
</blockquote>

<p>In the original publication these were <span class="MathJax_SVG" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03B1;</mi><mn>1</mn></msub><mo>=</mo><msub><mi>&amp;#x03B1;</mi><mn>2</mn></msub><mo>=</mo><msub><mi>&amp;#x03B1;</mi><mn>3</mn></msub><mo>=</mo><mn>0.8</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="19.893ex" height="2.295ex" viewBox="0 -740.1 8564.9 988.1" role="img" focusable="false" style="vertical-align: -0.576ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-31" x="905" y="-213"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-3D" x="1372" y="0"></use><g transform="translate(2428,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-32" x="905" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-3D" x="3800" y="0"></use><g transform="translate(4856,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-33" x="905" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-3D" x="6229" y="0"></use><g transform="translate(7285,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-30"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-2E" x="500" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-38" x="779" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mn>1</mn></msub><mo>=</mo><msub><mi>α</mi><mn>2</mn></msub><mo>=</mo><msub><mi>α</mi><mn>3</mn></msub><mo>=</mo><mn>0.8</mn></math></span></span><script type="math/tex" id="MathJax-Element-17">\alpha_1=\alpha_2=\alpha_3=0.8</script> for all the noncontrol cytosines.</p>



<h4 id="control-cytosines">Control cytosines</h4>

<p>The files <strong>control_data.tsv</strong> and <strong>control_prior.tsv</strong> have the count data and prior information on the control cytosines of interest, respectively.</p>

<p>Luckily, the data for the control cytosines is supplied in the same format as noncontrol data (see <em>above</em>). That is, each line in the file <strong>control_data.tsv</strong> is composed of one or more replicate-specific tab-separated blocks of four tab-separated nonnegative integers.</p>

<p>As in <strong>data.tsv</strong>, on each line there should be exactly <span class="MathJax_SVG" id="MathJax-Element-33-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>4</mn><mo>&amp;#x00D7;</mo><msub><mi>N</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>replicates</mtext></mrow></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.874ex" height="2.524ex" viewBox="0 -740.1 5543.1 1086.5" role="img" focusable="false" style="vertical-align: -0.805ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-34" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-D7" x="722" y="0"></use><g transform="translate(1723,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-4E" x="0" y="0"></use><g transform="translate(803,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-72"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65" x="392" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-70" x="837" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6C" x="1393" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-69" x="1672" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-63" x="1950" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-61" x="2395" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-74" x="2895" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65" x="3285" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-73" x="3729" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mo>×</mo><msub><mi>N</mi><mrow class="MJX-TeXAtom-ORD"><mtext>replicates</mtext></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-33">4 \times N_{\text{replicates}}</script> values separated with the tabs. Each of the replicate specified in <strong>data.csv</strong> should have its own control data. Moreover, the order of the replicate-specific blocks between the noncontrol and control data is assumed to be the same.</p>

<p>The prior knowledge on the control cytosines is supplied in the file <strong>control_prior.tsv</strong>. Although, the hierarchical model allows that the control cytosines would have different priors between replicates but this is not implemented in the current version. Therefore, each line in <strong>control_prior.tsv</strong> should have exactly three tab-separated values and the order of the rows, i.e., control cytosines, should be the same in <strong>control_data.tsv</strong> and <strong>control_prior.tsv</strong>.</p>

<h3 id="summarizing-hmc-chains">Summarizing HMC chains</h3>

<p>After the runs are completed their output can be summarized using <strong>print</strong> as follows</p>

<pre><code>$STAN_HOME/bin/print v65_output.csv
$STAN_HOME/bin/print t2kd_output.csv
</code></pre>

<p>For instance, the summary includes posterior means, standard deviations, quantiles and convergence diagnostic statistics for each of the parameters.</p>

<p>For more details on the output of <strong>print</strong>, please see the documentation of <strong>CmdStan</strong> available at <a href="http://mc-stan.org/documentation/">http://mc-stan.org/documentation/</a>.</p>



<h4 id="interpreting-the-parameters-in-the-implementation">Interpreting the parameters in the implementation</h4>

<p>The replicate-specific experimental parameters <span class="MathJax_SVG" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mtext>BS</mtext><mtext>eff</mtext></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.907ex" height="2.409ex" viewBox="0 -789.3 2112.8 1037.3" role="img" focusable="false" style="vertical-align: -0.576ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-42"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-53" x="708" y="0"></use><g transform="translate(1265,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-66" x="444" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-66" x="751" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mtext>BS</mtext><mtext>eff</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-19">\text{BS}_\text{eff}</script>, <span class="MathJax_SVG" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mtext>ox</mtext><mtext>eff</mtext></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.359ex" height="1.838ex" viewBox="0 -543.3 1876.8 791.3" role="img" focusable="false" style="vertical-align: -0.576ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6F"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-78" x="500" y="0"></use><g transform="translate(1029,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-66" x="444" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-66" x="751" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mtext>ox</mtext><mtext>eff</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-20">\text{ox}_\text{eff}</script>, <span class="MathJax_SVG" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msubsup><mtext>BS</mtext><mtext>eff</mtext><mo>&amp;#x2217;</mo></msubsup></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.907ex" height="2.752ex" viewBox="0 -838.5 2112.8 1184.9" role="img" focusable="false" style="vertical-align: -0.805ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-42"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-53" x="708" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-2217" x="1788" y="612"></use><g transform="translate(1265,-248)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-66" x="444" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-66" x="751" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msubsup><mtext>BS</mtext><mtext>eff</mtext><mo>∗</mo></msubsup></math></span></span><script type="math/tex" id="MathJax-Element-21">\text{BS}^*_\text{eff}</script> and <span class="MathJax_SVG" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mtext>seq</mtext><mtext>err</mtext></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.428ex" height="1.952ex" viewBox="0 -543.3 2336.9 840.5" role="img" focusable="false" style="vertical-align: -0.69ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-73"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65" x="394" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-71" x="839" y="0"></use><g transform="translate(1367,-231)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-72" x="444" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-72" x="837" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mtext>seq</mtext><mtext>err</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-22">\text{seq}_\text{err}</script> are stored in the parameter vectors <strong>bsEff</strong>, <strong>oxEff</strong>, <strong>bsBEff</strong> and <strong>seqErr</strong>, respectively.</p>

<p>The methylation proportion parameters of noncontrol cytosines <span class="MathJax_SVG" id="MathJax-Element-23-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03BC;</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.402ex" height="1.952ex" viewBox="0 -543.3 603.5 840.5" role="img" focusable="false" style="vertical-align: -0.69ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3BC" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi></math></span></span><script type="math/tex" id="MathJax-Element-23">\mu</script> and <span class="MathJax_SVG" id="MathJax-Element-24-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B8;</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="2.066ex" viewBox="0 -789.3 469.5 889.7" role="img" focusable="false" style="vertical-align: -0.233ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B8" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-24">\theta</script> have the following variable names in the implementation <strong>mu</strong> and <strong>theta</strong>, respectively. <br>
In the implementation <strong>mu</strong> is a two-dimensional matrix (<span class="MathJax_SVG" id="MathJax-Element-25-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>N</mi><mtext>cytosines</mtext></msub><mo>&amp;#x00D7;</mo><msub><mi>N</mi><mtext>replicates</mtext></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="20.267ex" height="2.524ex" viewBox="0 -740.1 8726 1086.5" role="img" focusable="false" style="vertical-align: -0.805ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-4E" x="0" y="0"></use><g transform="translate(803,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-63"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-79" x="444" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-74" x="972" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6F" x="1362" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-73" x="1863" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-69" x="2257" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6E" x="2536" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65" x="3092" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-73" x="3536" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-D7" x="3905" y="0"></use><g transform="translate(4906,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-4E" x="0" y="0"></use><g transform="translate(803,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-72"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65" x="392" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-70" x="837" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6C" x="1393" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-69" x="1672" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-63" x="1950" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-61" x="2395" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-74" x="2895" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65" x="3285" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-73" x="3729" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>N</mi><mtext>cytosines</mtext></msub><mo>×</mo><msub><mi>N</mi><mtext>replicates</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-25">N_\text{cytosines} \times N_\text{replicates}</script>), where the elements are 3-simplices. Whereas, <strong>mu</strong> is a vector (<span class="MathJax_SVG" id="MathJax-Element-26-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>N</mi><mtext>cytosines</mtext></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.555ex" height="2.524ex" viewBox="0 -740.1 3683.5 1086.5" role="img" focusable="false" style="vertical-align: -0.805ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-4E" x="0" y="0"></use><g transform="translate(803,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-63"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-79" x="444" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-74" x="972" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6F" x="1362" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-73" x="1863" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-69" x="2257" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6E" x="2536" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65" x="3092" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-73" x="3536" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>N</mi><mtext>cytosines</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-26">N_\text{cytosines}</script>) in which the elements are 3-simplices.</p>

<p>The methylation proportion parameters of control cytosines <span class="MathJax_SVG" id="MathJax-Element-27-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03B8;</mi><mtext>control</mtext></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.352ex" height="2.409ex" viewBox="0 -789.3 2735 1037.3" role="img" focusable="false" style="vertical-align: -0.576ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B8" x="0" y="0"></use><g transform="translate(469,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-63"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6F" x="444" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6E" x="945" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-74" x="1501" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-72" x="1891" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6F" x="2283" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6C" x="2784" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mtext>control</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-27">\theta_\text{control}</script> has the following variable names in the implementation <strong>theta_control</strong>. The parameters <strong>theta_control</strong> is a vector (<span class="MathJax_SVG" id="MathJax-Element-28-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>N</mi><mtext>control cytosines</mtext></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.165ex" height="2.524ex" viewBox="0 -740.1 6099 1086.5" role="img" focusable="false" style="vertical-align: -0.805ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-4E" x="0" y="0"></use><g transform="translate(803,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-63"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6F" x="444" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6E" x="945" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-74" x="1501" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-72" x="1891" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6F" x="2283" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6C" x="2784" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-63" x="3416" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-79" x="3860" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-74" x="4389" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6F" x="4778" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-73" x="5279" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-69" x="5673" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-6E" x="5952" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-65" x="6508" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-73" x="6953" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>N</mi><mtext>control cytosines</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-28">N_\text{control cytosines}</script>) in which the elements are 3-simplices.</p>

<p>For more details on this, please see the parameter declarations in the source code of <strong>Lux</strong> in the file <strong><span>$</span>LUX_HOME/lux.stan</strong>.</p>



<h3 id="detecting-differential-methylation">Detecting differential methylation</h3>

<p>A python script <strong>bf.py</strong> is supplied for calculating Bayes factors</p>

<pre><code>usage: bf.py [-h] -c1 CHAIN1 -c2 CHAIN2 [-v]

Calculates Bayes factor between two conditions based on the Stan HMC output chains

optional arguments:
  -h, --help    show this help message and exit
  -c1 CHAIN1, --chain-1 CHAIN1    output chain of the first condition
  -c2 CHAIN2, --chain-2 CHAIN2    output chain of the second condition
  -v, --version    show program's version number and exit
</code></pre>

<p>For instance, to calculate Bayes factor from the supplied HMC chains used in the publication, type</p>

<pre><code>./bf.py --chain-1 v65_output.csv --chain-2 t2kd_output.csv
</code></pre>

<p>Then the first four output lines are</p>

<blockquote>
  <p>mu[1]\t0.000087\n <br>
  mu[2]\t0.000092\n <br>
  mu[3]\t0.000876\n <br>
  mu[4]\t0.000130</p>
</blockquote>

<p>The script calculates Bayes factor for every <strong>mu</strong> variable.</p>

<p>Notably, the chains are required to have the same number of <strong>mu</strong> variables, i.e., the same cytosines, and they should be supplied in the same order. However, calculation of Bayes factors between conditions with different number of replicates is supported. Additionally, <strong>bf.py</strong> assumes that <span class="MathJax_SVG" id="MathJax-Element-30-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03B1;</mi><mn>1</mn></msub><mo>=</mo><msub><mi>&amp;#x03B1;</mi><mn>2</mn></msub><mo>=</mo><msub><mi>&amp;#x03B1;</mi><mn>3</mn></msub><mo>=</mo><mn>0.8</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="19.893ex" height="2.295ex" viewBox="0 -740.1 8564.9 988.1" role="img" focusable="false" style="vertical-align: -0.576ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-31" x="905" y="-213"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-3D" x="1372" y="0"></use><g transform="translate(2428,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-32" x="905" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-3D" x="3800" y="0"></use><g transform="translate(4856,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMATHI-3B1" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-33" x="905" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-3D" x="6229" y="0"></use><g transform="translate(7285,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-30"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-2E" x="500" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#MJMAIN-38" x="779" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mn>1</mn></msub><mo>=</mo><msub><mi>α</mi><mn>2</mn></msub><mo>=</mo><msub><mi>α</mi><mn>3</mn></msub><mo>=</mo><mn>0.8</mn></math></span></span><script type="math/tex" id="MathJax-Element-30">\alpha_1=\alpha_2=\alpha_3=0.8</script>.</p>

<p>For more details on the the calculation of Bayes factor, please see the original publication in which the procedure is explained in detail.</p>

<h3 id="advanced-uses">Advanced uses</h3>

<p>Some users might want to consider of using <strong>Lux</strong> through the <strong>RStan</strong> or <strong>PyStan</strong> interfaces (see <a href="http://mc-stan.org/interfaces/">http://mc-stan.org/interfaces/</a>).</p>

<h3 id="references">References</h3>

<p>[1 ] M. J. Betancourt, “Generalizing the No-U-Turn Sampler to Riemannian Manifolds,” arXiv, vol. 1304, no. 1920, 2013.  <br>
[2] K. D. Hansen, B. Langmead and R. A. Irizarry, “BSmooth: from whole genome bisulfite sequencing reads to differentially methylated regions.,” Genome Biol, vol. 13, no. 10, pp. R83, Oct 2012.  <br>
[3] M. D. Hoffman and A. Gelman, “The No-U-Turn Sampler: Adaptively Setting Path Lengths in Hamiltonian Monte Carlo,” Journal of Machine Learning Research, vol. in press, 2013.  <br>
[4] F. Krueger and S. R. Andrews, “Bismark: a flexible aligner and methylation caller for Bisulfite-Seq applications.,” Bioinformatics, vol. 27, no. 11, pp. 1571-1572, Jun 2011.  <br>
[5] Stan Development Team, “Stan Modeling Language Users Guide and Reference Manual, Version 2.2,” 2014.  <br>
[6] Stan Development Team, “Stan: A C++ Library for Probability and Sampling, Version 2.2,” 2014.  <br>
[7] D. Sun, Y. Xi, B. Rodriguez, H. J. Park, P. Tong, M. Meong, M. A. Goodell and W. Li, “MOABS: model based analysis of bisulfite sequencing data.,” Genome Biol, vol. 15, no. 2, pp. R38, Feb 2014. </p></div></body>
</html>